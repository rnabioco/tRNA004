---
title: "pseudoUcorrelates"
author: "Laura White"
date: "2024-06-27"
output: html_document
---

```{r global options, include = FALSE}
knitr::opts_chunk$set(message=FALSE)
library(tidyverse)
library(Rsamtools)
library(cowplot)
library(here)
here::i_am("Rmd/pseudoUcorrelates.Rmd")
```
What's the relationship between ML score and basecalling error? Let's look at position 55 only in budding yeast on Ala-AGC for now.
```{r}
read_tsv(here("alignments/004supv5/yeastextract98.tsv")) %>%
  filter(mod_code=="17802" & ref_strand=="+" & ref_mod_strand=="+" & mod_strand=="+") -> allcalls


allcalls %>%
  select(read_id, ref_position) -> test


write_tsv(test, here("alignments/004supv5/yeastextract98_filtered.tsv"))
```
I used the file above and samtools and a custom script to grab the value of the CIGAR string at position 55 on the referece for all reads aligning to this tRNA. We can now pull this file in and join it to test.

```{r}
read_tsv(here("alignments/004supv5/output_with_errors.tsv")) %>%
  dplyr::rename(ref_chrom-> errors
left_join(allcalls, errors) -> all

all <- all %>%
  filter(!is.na(basecall_error)) %>%
  mutate(ref_base = substr(ref_kmer, 3, 3)) %>%
  mutate(basematch = if_else(basecall_error %in% c("insertion", "deletion"), "no", if_else(ref_base == canonical_base, "yes", "no")))


ggplot(all, aes(x = basematch, y = mod_qual)) +
 # geom_jitter(alpha = .2) +
  geom_violin(alpha = .8) +
  geom_boxplot(alpha = .8, width = .1) +
  theme_cowplot()


# Create overlapping density plots
ggplot(all, aes(x = mod_qual, fill = basematch)) +
  geom_density(alpha = 0.5) +
  theme_cowplot() +
  labs(title = "Are higher confidence mod scores \n more likely to match the reference nt?", x = "mod_qual", y = "Density") +
  scale_fill_manual(values = c("yes" = "blue", "no" = "red"))
```
New question: what about ML score correlation with number of modifications in the surrounding 5mer?
